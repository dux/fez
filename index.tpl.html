<%
  load './demo/main.rb'
%>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test</title>
  <link rel="icon" href="./demo/fez.png">
  <link rel="stylesheet" href="./demo/main.css" />
  <link rel="stylesheet" href="./demo/hjs-theme.css" />
  <link rel="stylesheet" href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
  <script src="./dist/fez.js"></script>
  <script>
    hljs.addPlugin(new CopyButtonPlugin({autohide: false}));
  </script>
  <script>
    function timeSince(date) {
        const now = new Date();
        const secondsPast = (now.getTime() - new Date(date).getTime()) / 1000;

        if (secondsPast < 60) {
            return `just now`;
        }
        if (secondsPast < 3600) { // less than 60 minutes
            const minutes = Math.floor(secondsPast / 60);
            return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
        }
        if (secondsPast < 86400) { // less than 24 hours
            const hours = Math.floor(secondsPast / 3600);
            return `${hours} hour${hours > 1 ? 's' : ''} ago`;
        }
        if (secondsPast < 2592000) { // less than 30 days
            const days = Math.floor(secondsPast / 86400);
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }
        if (secondsPast < 31536000) { // less than 12 months
            const months = Math.floor(secondsPast / 2592000);
            return `${months} month${months > 1 ? 's' : ''} ago`;
        }
        const years = Math.floor(secondsPast / 31536000);
        return `${years} year${years > 1 ? 's' : ''} ago`;
    }

    window.L = console.log
</script>
</head>
<body>
  <img src="./demo/fez.png" style="height: 128px; float: right; margin-bottom: -100px;" />
  <h1>
    Fez demo components
    &sdot;
    <a target="playground" href="https://jsitor.com/QoResUvMc">playground</a>
    &sdot;
    <a target="repo" href="https://github.com/dux/fez">GitHub repo</a>
  </h1>

  <p>Fez was created by <a href="https://github.com/dux/">@dux</a> in 2024. Latest update was <script>document.write(timeSince('<%= `git log -1 --format=%cd`.chomp %>'))</script>.

  <h2>How FEZ feels and works?</h2>

  <p>Component model is similar to <code>Vue</code> or <code>Svelte</code>, but there is no compile step, and you just work on whole HTML page as it is monuted to root. Render pages from server, and just use custom HTML tags you have created, as you would use any other HTML tag.</p>

  <ul>
    <li>üîå <i>Native Browser Components:</i> Uses standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_components/Using_custom_elements">custom elements</a>. Create tags like <code>&lt;ui-clock&gt;</code>, place them anywhere in your HTML, and they just work. (Try it now in dev tools - instant magic!)</li>
    <li>‚ö° <i>Zero Build Step Hassle:</i> Works directly in the browser with a tiny runtime (20kb raw, 6kb zipped - smaller than most cat GIFs).</li>
    <li>üîÑ <i>Smart State Management:</i> Automatically re-renders components using <a href="https://github.com/bigskysoftware/idiomorph">Idiomorph</a> for efficient DOM updates when data changes.</li>
    <li>üìú <i>Flexible Templating:</i> Choose between HTML-like templates (similar to <a href="https://dev.to/cloudcannon/templating-in-sveltekit-3ikm">Svelte</a>) or programmatic <a href="https://github.com/dux/fez/blob/main/src/vendor/n.js">node building</a>.</li>
    <li>üé® <i>CSS Superpowers:</i> Built-in SCSS support via <a href="https://goober.js.org/">Goober</a> with scoped/global styles and dynamic values.</li>
    <li>ü§ù <i>Familiar Syntax:</i> Supports Svelte-style <code>use</code>/<code>bind</code> and Vue-like <code>:attribute</code> bindings.</li>
    <li>üí° <i>Stateful Slots:</i> Preserves slot content state during re-renders - form inputs stay filled, components keep their data.</li>
    <li>üì° <i>Component Communication:</i> Straightforward parent-child interactions without complex state management.</li>
    <li>üîî <i>Event System:</i> Built-in pub/sub pattern for cross-component messaging.</li>
    <li>‚è≥ <i>Lifecycle Control:</i> Hooks like <code>onMount</code>, <code>beforeRender</code>, and <code>onPropsChange</code> for precise timing.</li>
  </ul>

  <h2>How to build your first component</h2>

  <p>Lets build simple counter</p>

  <ol>
    <li>Add Fez JS (to HEAD)
      <xmp>
<script src="https://dux.github.io/fez/dist/fez.js"></script>
      </xmp>
    </li>
    <li>
      Create ex-counter component

      <xmp id="demo-counter">
<fez-compile tag="ex-counter">
  <template>
    <script>
      connect() {
        this.state.count = 0
      }

      more() {
        this.state.count += this.state.count > 9 ? 0 : 1
      }
    </script>

    <style>
      span {
        margin: 0 10px;
        color: blue;
      }
    </style>

    <button onclick="$$.state.count -= 1">-</button>
    <span>
      {{ @state.count }}
    </span>
    <button onclick="$$.more()">+</button>
    {{#if true && @state.count > 0}}
      <span>&mdash;</span>
      {{#if @state.count % 2 }} odd {{:else}} even {{/if}}
    {{/if}}
  </template>
</fez-compile>
      </xmp>
      <script>$('#demo-counter').after($('#demo-counter').html())</script>
    </li>
    <li>
      Place ex-counter anywhere in BODY
      <xmp>
<ex-counter></ex-counter>
      </xmp>
    </li>
    <li>
      <p>That is it! Edit this demo on <a target="codepen" href="https://codepen.io/dux/pen/JoPwmje">CodePen</a></p>
      <ex-counter></ex-counter>
    </li>
  </ol>

  <%= fez('clock') %>
  <%= fez('todo') %>
  <%= fez('form') %>
  <%= fez('time') %>
  <%= fez('icon') %>
  <%= fez('pubsub') %>
  <%= fez('list') %>
  <%= fez('tabs') %>
  <%= fez('border') %>

  <template fez="app-editor">
    <script>
      getSource() {
        return this.codeNode.textContent
      }

      connect(props) {
        props.language ||= 'html'
        this.source = this.root.innerHTML
      }

      onMount() {
        this.codeNode = this.find('code')
        this.codeNode.innerHTML = this.source.trim()
        hljs.highlightElement(this.codeNode);
      }
    </script>

    <style>
      code {
        padding: 10px;
      }

      .hljs-copy-button {
        overflow: visible;
        left: -5px;
        top: 30px;
      }
    </style>

    <div class="relative">
      <pre>
        {{#if @props.file}}
          <div style="margin-bottom: -10px;">
            {{ @props.file }} &sdot; <span style="cursor: pointer;" onclick="applyChanges('{{ @props.name }}')">Save</span>
          </div>
        {{/if}}
        <code class="language-js" contenteditable="true"></code>
      </pre>
    </div>
  </template>

  <script>
    window.applyChanges = function(name) {
      Fez.compile(`ui-${name}`, Fez(`#code-ui-${name}`).getSource())

      $(`#body-${name}`).html( Fez(`#html-${name}`).getSource() )
    }
  </script>
</body>
</html>

